
LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
USE IEEE.NUMERIC_STD.ALL;
USE IEEE.STD_LOGIC_UNSIGNED.ALL;


ENTITY DATAPATH_123 IS
	PORT(
			clk         : IN STD_LOGIC;
			rst         : IN STD_LOGIC;
			pc_en	      : IN STD_LOGIC;
			pc_wr_en    : IN STD_LOGIC;
			ram_clk     : IN STD_LOGIC;
			ram_en      : IN STD_LOGIC;								
			ram_wr      : IN STD_LOGIC;
			reg_filr_en : IN STD_LOGIC;
			alu_en      : IN STD_LOGIC;
	);
END DATAPATH_123;




ARCHITECTURE BHV OF DATAPATH_123 IS 
------------------------I SEGNALI INTERNI QUI---------------------
------------------------------------------------------------------

	COMPONENT PROGRAM_COUNTER_32_BIT IS
		PORT(	en		  : IN  STD_LOGIC;
				clk     : IN  STD_LOGIC;
				wr_en   : IN  STD_LOGIC;
				rst     : IN  STD_LOGIC;
				jmp_v   : IN  STD_LOGIC_VECTOR(31 DOWNTO 0);	
				cnt_v   : OUT STD_LOGIC_VECTOR(31 DOWNTO 0)		
		);
	END COMPONENT;
	
	COMPONENT REGISTER32 IS 
		PORT( en    : IN  STD_LOGIC;
				rst   : IN  STD_LOGIC;
				wr_en : IN  STD_LOGIC;
				d_in  : IN  STD_LOGIC_VECTOR(31 DOWNTO 0);
				d_out : OUT STD_LOGIC_VECTOR(31 DOWNTO 0)
		);
	END COMPONENT;
	
	COMPONENT RAM IS 
		PORT( ram_clk  : IN  STD_LOGIC;								
		      en       : IN  STD_LOGIC;								
				wr       : IN  STD_LOGIC;								
				addr     : IN  STD_LOGIC_VECTOR(29 DOWNTO 0);	
				data_in  : IN  STD_LOGIC_VECTOR(31 DOWNTO 0);	
				out_en   : OUT STD_LOGIC;								
				mem_busy : OUT STD_LOGIC;								
				rm       : OUT STD_LOGIC_VECTOR(31 DOWNTO 0)	
	    );
  END COMPONENT;
  
  COMPONENT REGISTER_FILE IS
		PORT( en : IN  STD_LOGIC;
				rst: IN  STD_LOGIC;
				clk: IN  STD_LOGIC;
				rw : IN  STD_LOGIC; 	
				A  : IN  STD_LOGIC_VECTOR(4 DOWNTO 0);
				B  : IN  STD_LOGIC_VECTOR(4 DOWNTO 0);
				C  : IN  STD_LOGIC_VECTOR(4 DOWNTO 0);
				RA : OUT STD_LOGIC_VECTOR(31 DOWNTO 0);
				RB : OUT STD_LOGIC_VECTOR(31 DOWNTO 0);
				RC : IN  STD_LOGIC_VECTOR(31 DOWNTO 0)
			  );			
  END COMPONENT;
  
  COMPONENT ALU_32_BIT IS
	PORT(	en     : IN  STD_LOGIC;
			op_sel : IN  STD_LOGIC_VECTOR( 4 DOWNTO 0);
			RA     : IN  STD_LOGIC_VECTOR(31 DOWNTO 0);
			RB     : IN  STD_LOGIC_VECTOR(31 DOWNTO 0);
			RZ     : OUT STD_LOGIC_VECTOR(31 DOWNTO 0);
			FLAG_B : OUT STD_LOGIC_VECTOR( 7 DOWNTO 0)	
		);
  END COMPONENT;
	
	
	--------INIZIA LA DESCRIZIONE E L'ISTANZIAMENTO DEI COMPONENTI--------------
	BEGIN 
		PC  : PROGRAM_COUNTER_32_BIT PORT MAP();
		MAR : REGISTER32 PORT MAP();
		RAM : RAM PORT MAP();
		IR  : REGISTER32 PORT MAP();
		RF  : REGISTER_FILE PORT MAP();
		ALU : ALU_32_BIT PORT MAP();

END BHV;